(()=>{"use strict";var t=document.querySelector("#saved-profil"),e=document.querySelector("#name-surname"),o=document.querySelector("#about-me"),n=document.querySelector("#new-post"),r=document.querySelector("#post-name"),c=document.querySelector("#post-link"),u=document.querySelector(".popup_add-post"),i=document.querySelector("#new-avatar"),a=document.querySelector("#avatar-link");function s(t){t.classList.remove("popup_opened"),t.removeEventListener("click",l),document.removeEventListener("keydown",p)}function l(t){var e=t.currentTarget,o=t.target;(o.classList.contains("popup")||o.classList.contains("popup__close"))&&s(e)}function p(t){"Escape"===t.key&&s(document.querySelector(".popup_opened"))}function d(t,e){e.textContent=t?"Сохранение...":"Сохраненить"}t.addEventListener("submit",(function(n){n.preventDefault(),d(!0,t.querySelector(".popup__button-submit")),T(e.value.trim(),o.value.trim()),s(h)})),n.addEventListener("submit",(function(t){t.preventDefault();var e=r.value.trim(),o=c.value.trim();d(!0,n.querySelector(".popup__button-submit")),j(e,o),s(u)})),i.addEventListener("submit",(function(t){t.preventDefault();var e=a.value.trim();d(!0,i.querySelector(".popup__button-submit")),A(e),s(_)}));var m=document.querySelector(".profile__name"),f=document.querySelector(".profile__description"),h=document.querySelector(".popup_edit-profile"),v=document.querySelector(".profile__avatar"),_=document.querySelector(".popup_add-avatar");function y(t){t.classList.add("popup_opened"),t.addEventListener("click",l),document.addEventListener("keydown",p)}var b=document.querySelector("#template-post").content,S=document.querySelector(".posts__list"),q=document.querySelector(".popup_zoom-image"),k=document.querySelector(".popup__zoom-image"),E=document.querySelector(".popup__zoom-description");function g(t,e,o,n,r,c){var u=function(t,e,o,n,r,c,u){var i=b.querySelector(".post").cloneNode(!0),a=i.querySelector(".post__like"),s=i.querySelector(".post__image"),l=i.querySelector(".post__trash"),p=i.querySelector(".post__name"),d=i.querySelector(".post__like-count");return u&&a.classList.add("post__like_active"),n==r?(l.setAttribute("data-card-Id",c),l.addEventListener("click",(function(){!function(t){var e=t.getAttribute("data-card-Id");x(e),t.closest(".post").remove()}(l)}))):l.remove(),s.src=t,s.alt=e,p.textContent=e,d.textContent=o,a.setAttribute("data-card-Id",c),a.addEventListener("click",(function(){!function(t,e,o){t.classList.contains("post__like_active")?z(e,o):P(e,o),t.classList.toggle("post__like_active")}(a,c,d)})),s.addEventListener("click",(function(){!function(t,e){k.src=t.getAttribute("src"),k.alt=e,E.textContent=e,y(q)}(s,e)})),i}(t,e,o,n,r,c,arguments.length>6&&void 0!==arguments[6]&&arguments[6]);S.prepend(u)}var L,C="",j=function(t,e){return fetch("https://nomoreparties.co/v1/plus-cohort-21/cards ",{method:"POST",headers:{authorization:"00d0c259-9510-40e2-8a54-40ce9400cb37","Content-Type":"application/json"},body:JSON.stringify({name:t,link:e})}).then((function(t){return t.ok?t.json():Promise.reject("Что-то пошло не так: ".concat(t.status))})).then((function(t){var e=t.link,o=t.name,n=t.likes.length,r=t.owner._id,c=t._id;console.log(t),g(e,o,n,C,r,c)})).catch((function(t){console.log(t)})).finally((function(){d(!1,n.querySelector(".popup__button-submit"))}))},x=function(t){return fetch("https://nomoreparties.co/v1/plus-cohort-21/cards/".concat(t),{method:"DELETE",headers:{authorization:"00d0c259-9510-40e2-8a54-40ce9400cb37"}}).then((function(t){return t.ok?t.json():Promise.reject("Что-то пошло не так: ".concat(t.status))})).catch((function(t){console.log(t)}))},T=function(e,o){return fetch("https://nomoreparties.co/v1/plus-cohort-21/users/me",{method:"PATCH",headers:{authorization:"00d0c259-9510-40e2-8a54-40ce9400cb37","Content-Type":"application/json"},body:JSON.stringify({name:e,about:o})}).then((function(t){return t.ok?t.json():Promise.reject("Что-то пошло не так: ".concat(t.status))})).then((function(t){!function(t){m.textContent=t.name,f.textContent=t.about}(t)})).catch((function(t){console.log(t)})).finally((function(){d(!1,t.querySelector(".popup__button-submit"))}))},P=function(t,e){return fetch("https://nomoreparties.co/v1/plus-cohort-21/cards/likes/".concat(t),{method:"PUT",headers:{authorization:"00d0c259-9510-40e2-8a54-40ce9400cb37","Content-Type":"application/json"}}).then((function(t){return t.ok?t.json():Promise.reject("Что-то пошло не так: ".concat(t.status))})).then((function(t){e.textContent=t.likes.length})).catch((function(t){console.log(t)}))},z=function(t,e){return fetch("https://nomoreparties.co/v1/plus-cohort-21/cards/likes/".concat(t),{method:"DELETE",headers:{authorization:"00d0c259-9510-40e2-8a54-40ce9400cb37","Content-Type":"application/json"}}).then((function(t){return t.ok?t.json():Promise.reject("Что-то пошло не так: ".concat(t.status))})).then((function(t){e.textContent=t.likes.length})).catch((function(t){console.log(t)}))},A=function(t){return fetch("https://nomoreparties.co/v1/plus-cohort-21/users/me/avatar ",{method:"PATCH",headers:{authorization:"00d0c259-9510-40e2-8a54-40ce9400cb37","Content-Type":"application/json"},body:JSON.stringify({avatar:t})}).then((function(t){return t.ok?t.json():Promise.reject("Что-то пошло не так: ".concat(t.status))})).then((function(t){var e;e=t.avatar,v.src=e})).catch((function(t){console.log(t)})).finally((function(){d(!1,i.querySelector(".popup__button-submit"))}))},D=function(t,e,o){!function(t){return t.some((function(t){return!t.validity.valid}))}(t)?(e.disabled=!1,e.classList.remove(o.buttonDisabled)):(e.disabled=!0,e.classList.add(o.buttonDisabled))},w=document.querySelector(".profile__edit"),N=document.querySelector(".profile__add-post");document.querySelector(".profile__add-avatar").addEventListener("click",(function(){i.reset(),y(_)})),w.addEventListener("click",(function(){var t,n;t=m,n=f,e.value=t.textContent.trim(),o.value=n.textContent.trim(),y(h)})),N.addEventListener("click",(function(){n.reset(),y(u)})),L={form:".popup__form",input:".popup__input-text",inputError:"popup__input-text_error",messageError:"popup__message-error_active",button:".popup__button-submit",buttonDisabled:"popup__button-submit_disabled"},Array.from(document.querySelectorAll(L.form)).forEach((function(t){!function(t,e){var o=Array.from(t.querySelectorAll(e.input)),n=t.querySelector(e.button);D(o,n,e),o.forEach((function(r){r.addEventListener("input",(function(){!function(t,e,o){e.validity.patternMismatch?e.setCustomValidity(e.dataset.errorMessage):e.setCustomValidity(""),e.validity.valid?function(t,e,o){var n=t.querySelector(".".concat(e.id,"-error"));e.classList.remove(o.inputError),n.classList.remove(o.messageError),n.textContent=""}(t,e,o):function(t,e,o,n){var r=t.querySelector(".".concat(e.id,"-error"));e.classList.add(n.inputError),r.textContent=o,r.classList.add(n.messageError)}(t,e,e.validationMessage,o)}(t,r,e),D(o,n,e)}))})),t.addEventListener("reset",(function(){setTimeout((function(){D(o,n,e)}))}))}(t,L)})),fetch("https://nomoreparties.co/v1/plus-cohort-21/users/me",{method:"GET",headers:{authorization:"00d0c259-9510-40e2-8a54-40ce9400cb37"}}).then((function(t){return t.ok?t.json():Promise.reject("Что-то пошло не так: ".concat(t.status))})).then((function(t){m.textContent=t.name,f.textContent=t.about,v.src=t.avatar,C=t._id})).catch((function(t){console.log(t)})),fetch("https://nomoreparties.co/v1/plus-cohort-21/cards",{method:"GET",headers:{authorization:"00d0c259-9510-40e2-8a54-40ce9400cb37"}}).then((function(t){return t.ok?t.json():Promise.reject("Что-то пошло не так: ".concat(t.status))})).then((function(t){t.reverse().forEach((function(t){var e=t.link,o=t.name,n=t.likes,r=t.owner._id,c=t._id;g(e,o,n.length,C,r,c,function(t){var e=!1;return t.forEach((function(t){t._id===C&&(e=!0)})),e}(n))}))})).catch((function(t){console.log(t)}))})();